# Copyright (C) 2015 Swift Navigation Inc.
# Contact: Fergus Noble <fergus@swiftnav.com>
#
# This source is subject to the license found in the file 'LICENSE' which must
# be be distributed together with this source. All other rights reserved.
#
# THIS CODE AND INFORMATION IS PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND,
# EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED
# WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE.

package: swiftnav.sbp.tracking
description: |
  Satellite code and carrier-phase tracking messages from the device.
stable: False
public: True
include:
  - types.yaml
  - gnss_signal.yaml
  - observation.yaml
definitions:

 - MSG_TRACKING_STATE_DETAILED:
    id: 0x0011
    short_desc: Detailed signal tracking channel states
    desc: |
      The tracking message returns a set tracking channel parameters for a
      single tracking channel useful for debugging issues.
    fields:
        - recv_time:
            type: u64
            units: ns
            desc: Receiver clock time.
        - tot:
            type: ObsGPSTime
            desc: Time of transmission of signal from satellite.
        - P:
            type: u32
            units: 2 cm
            desc: Pseudorange observation.
        - P_std:
            type: u16
            units: 2 cm
            desc: Pseudorange observation standard deviation.
        - L:
            type: CarrierPhase
            units: cycles
            desc: Carrier phase observation with typical sign convention.
        - cn0:
            type: u8
            units: dB Hz * 4
            desc: Carrier-to-Noise density
        - lock:
            type: u16
            desc: |
              Lock indicator. This value changes whenever a satellite
              signal has lost and regained lock, indicating that the
              carrier phase ambiguity may have changed.
        - sid:
            type: GnssSignal
            desc: GNSS signal identifier.
        - doppler:
            type: s32
            units: Hz * 10
            desc: Carrier Doppler frequency.
        - doppler_std:
            type: u16
            units: Hz * 10
            desc: Carrier Doppler frequency standard deviation.
        - uptime:
            type: u32
            units: s
            desc: |
              Number of seconds of continuous tracking. Specifies how much time
              signal is in continuous track.
        - clock_offset:
            type: u16
            units: ppb * 10
            desc: TCXO clock offset.
        - clock_drift:
            type: u16
            units: (ppb * 10) / s
            desc: TCXO clock drift.
        - corr_spacing:
            type: u16
            units: ns
            desc: Early-Prompt (EP) and Prompt-Late (PL) correlators spacing.
        - acceleration:
            type: u8
            units: g * 10
            desc: Acceleration.
        - sync_flags:
            type: u8
            desc: Synchronisation status flags.
        - tow_flags:
            type: u8
            desc: TOW status flags.
        - track_flags:
            type: u8
            desc: Tracking loop status flags.
        - nav_flags:
            type: u8
            desc: Navigation data status flags.
        - pset_flags:
            type: u8
            desc: Parameters sets flags.
        - misc_flags:
            type: u8
            desc: Miscellanious flags.

 - TrackingChannelState:
    short_desc: Signal tracking channel state
    desc: |
      Tracking channel state for a specific satellite signal and
      measured signal power.
    fields:
        - state:
            type: u8
            desc: Status of tracking channel
            fields:
                - 2-7:
                    desc: Reserved
                - 0-1:
                    desc: Tracking mode
                    values:
                        - 0: Disabled
                        - 1: Running
        - sid:
            type: GnssSignal
            desc: GNSS signal being tracked
        - cn0:
            type: float
            units: dB Hz
            desc: Carrier-to-noise density

 - MSG_TRACKING_STATE:
    id: 0x0013
    short_desc: Signal tracking channel states
    desc: |
      The tracking message returns a variable-length array of tracking
      channel states. It reports status and carrier-to-noise density
      measurements for all tracked satellites.
    fields:
      - states:
          type: array
          fill: TrackingChannelState
          desc: Signal tracking channel state

 - TrackingChannelCorrelation:
    short_desc: Complex correlation structure
    desc: |
      Structure containing in-phase and quadrature correlation components.
    fields:
        - I:
            type: s32
            desc: In-phase correlation
        - Q:
            type: s32
            desc: Quadrature correlation

 - MSG_TRACKING_IQ:
    id: 0x001C
    short_desc: Tracking channel correlations
    desc: |
      When enabled, a tracking channel can output the correlations at each
      update interval.
    fields:
      - channel:
          type: u8
          desc: Tracking channel of origin
      - sid:
          type: GnssSignal
          desc: GNSS signal identifier
      - corrs:
          type: array
          fill: TrackingChannelCorrelation
          size: 3
          desc: Early, Prompt and Late correlations

 - TrackingChannelStateDepA:
    short_desc: Deprecated
    desc: Deprecated.
    replaced_by:
      - TrackingChannelState
    fields:
        - state:
            type: u8
            desc: Status of tracking channel
            fields:
                - 2-7:
                    desc: Reserved
                - 0-1:
                    desc: Tracking mode
                    values:
                        - 0: Disabled
                        - 1: Running
        - prn:
            type: u8
            desc: PRN-1 being tracked
        - cn0:
            type: float
            units: dB Hz
            desc: Carrier-to-noise density

 - MSG_TRACKING_STATE_DEP_A:
    id: 0x0016
    short_desc: Deprecated
    desc: Deprecated.
    public: False
    replaced_by:
      - MSG_TRACKING_STATE
    fields:
      - states:
          type: array
          fill: TrackingChannelStateDepA
          desc: Satellite tracking channel state
